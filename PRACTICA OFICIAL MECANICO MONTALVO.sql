CREATE DATABASE MECANICO;
GO

USE MECANICO;
GO

CREATE TABLE PAIS (
    ID_PAIS INT PRIMARY KEY,
    PAIS VARCHAR(20) NOT NULL
)

CREATE TABLE MODELO (
    ID_MODELO INT PRIMARY KEY,
    MODELO VARCHAR(50) NOT NULL,
    ID_PAIS INT,
    CONSTRAINT FK_MODELO_PAIS FOREIGN KEY (ID_PAIS) REFERENCES PAIS(ID_PAIS)
)

CREATE TABLE OBR_AUXI(
    ID_OBRERO_AUX INT PRIMARY KEY,
    NOMBRE VARCHAR(100)
)

CREATE TABLE OBR_DIRECTO(
    ID_OBRERO_DIREC INT PRIMARY KEY  ,
    NOMBRE VARCHAR(100) NOT NULL
)

CREATE TABLE OBRERO(
    ID_OBRERO CHAR(4) PRIMARY KEY,
    NOMBRE VARCHAR(30) NOT NULL,
    CALI_LABORAL VARCHAR(20) NOT NULL,
    CAT_OCUPACIONAL VARCHAR(20) NOT NULL,
    ID_OBRERO_AUX INT,
    ID_OBRERO_DIREC INT,
    CONSTRAINT FK_AUXI_OBRERO FOREIGN KEY(ID_OBRERO_AUX) REFERENCES OBR_AUXI(ID_OBRERO_AUX),
    CONSTRAINT FK_DIREC_OBRERO FOREIGN KEY(ID_OBRERO_DIREC) REFERENCES OBR_DIRECTO(ID_OBRERO_DIREC)
)

CREATE TABLE NORMA(
    ID_NORMA CHAR(4) PRIMARY KEY,
    ID_OBRERO_DIREC INT FOREIGN KEY REFERENCES OBR_DIRECTO(ID_OBRERO_DIREC),
    DESCRIPCION VARCHAR(MAX) NOT NULL,
    TIEMPO_EJECU VARCHAR(20) NOT NULL
)

CREATE TABLE EQUIPO(
    ID_EQUIPO CHAR(4) PRIMARY KEY,
    NOMBRE VARCHAR(30) UNIQUE NOT NULL,
    ID_PAIS INT,
    ID_MODELO INT,
    CONSTRAINT FK_EQUIPO_PAIS FOREIGN KEY (ID_PAIS) REFERENCES PAIS(ID_PAIS),
    CONSTRAINT FK_EQUIPO_MODELO FOREIGN KEY (ID_MODELO) REFERENCES MODELO(ID_MODELO)
)

CREATE TABLE MANTENIMIENTO(
    ID_MANT CHAR(4) PRIMARY KEY,
    ID_EQUIPO CHAR(4) FOREIGN KEY REFERENCES EQUIPO(ID_EQUIPO),
    ID_OBRERO CHAR(4) FOREIGN KEY REFERENCES OBRERO(ID_OBRERO),
    ULTIMA_FECHA DATE NOT NULL,
    DESCRIPCION VARCHAR(100) NOT NULL
)

CREATE TABLE OPERACION(
    ID_OPE CHAR(4) PRIMARY KEY,
	 ID_NORMA CHAR(4) FOREIGN KEY REFERENCES NORMA(ID_NORMA),
    ID_EQUIPO CHAR(4) FOREIGN KEY REFERENCES EQUIPO(ID_EQUIPO),
    NOMBRE VARCHAR(30) NOT NULL,
    DESCRIPCION VARCHAR(100)
)

CREATE TABLE PIEZA(
    ID_PIEZA CHAR(4) PRIMARY KEY,
    ID_OPE CHAR(4) FOREIGN KEY REFERENCES OPERACION(ID_OPE),
    DESCRIPCION VARCHAR(MAX) NOT NULL,
    PESO_UNIT DECIMAL(6,2) NOT NULL
)


--REGISTRO DE TABLAS--

GO
INSERT INTO PAIS (ID_PAIS, PAIS) VALUES
(1, 'Argentina'),
(2, 'Brasil'),
(3, 'Chile'),
(4, 'Perú'),
(5, 'Colombia');
GO

INSERT INTO MODELO (ID_MODELO, MODELO, ID_PAIS) VALUES
(1, 'Modelo X', 1),
(2, 'Modelo Y', 2),
(3, 'Modelo Z', 3),
(4, 'Modelo W', 4),
(5, 'Modelo V', 5);

GO

INSERT INTO OBR_AUXI(ID_OBRERO_AUX,NOMBRE)VALUES
(1,'JUAN PEREZ'),
(2,'MARIA GOMEZ'),
(3,'CALORS LOPEZ'),
(4,'ANA RODRIGUEZ'),
(5,'PEDRO MARTINEZ')
GO

INSERT INTO OBR_DIRECTO(ID_OBRERO_DIREC,NOMBRE)VALUES
(1,'LUCAS PEREZ'),
(2,'JUAN RAMIREZ'),
(3,'SAKA RAMIREZ'),
(4,'FELIPE RAMIREZ'),
(5,'HECTOR RAMIREZ')
GO

INSERT INTO OBRERO (ID_OBRERO, NOMBRE, CALI_LABORAL, CAT_OCUPACIONAL) VALUES
('O1', 'Juan Pérez', 'Alta', 'Mecánico'),
('O2', 'María Gómez', 'Media', 'Electricista'),
('O3', 'Carlos López', 'Alta', 'Soldador'),
('O4', 'Ana Rodríguez', 'Baja', 'Mecánico'),
('O5', 'Pedro Martínez', 'Media', 'Electricista')

GO
INSERT INTO NORMA (ID_NORMA, ID_OBRERO_DIREC, DESCRIPCION, TIEMPO_EJECU) VALUES
('N1', 1, 'Norma 1', '15 minutos'),
('N2', 2, 'Norma 2', '20 minutos'),
('N3', 3, 'Norma 3', '25 minutos'),
('N4', 4, 'Norma 4', '30 minutos'),
('N5', 5,  'Norma 5', '35 minutos')

GO
INSERT INTO EQUIPO (ID_EQUIPO, NOMBRE, ID_PAIS, ID_MODELO) VALUES
('E1',  'Equipo 1', 1, 1),
('E2', 'Equipo 2', 2, 2),
('E3',  'Equipo 3', 3, 3),
('E4',  'Equipo 4', 4, 4),
('E5',  'Equipo 5', 5, 5)

GO
INSERT INTO MANTENIMIENTO (ID_MANT, ID_EQUIPO, ID_OBRERO, ULTIMA_FECHA, DESCRIPCION) VALUES
('M1', 'E1', 'O1', '2024-01-01', 'Mantenimiento preventivo'),
('M2', 'E2', 'O2', '2024-01-05', 'Revisión eléctrica'),
('M3', 'E3', 'O3', '2024-01-10', 'Cambio de piezas'),
('M4', 'E4', 'O4', '2024-01-15', 'Lubricación general'),
('M5', 'E5', 'O5', '2024-01-20', 'Ajuste y calibración')
GO

INSERT INTO OPERACION (ID_OPE, ID_EQUIPO, NOMBRE, DESCRIPCION) VALUES
('P1', 'E1' ,'Operación 1', 'Descripción de la operación 1'),
('P2', 'E2', 'Operación 2', 'Descripción de la operación 2'),
('P3', 'E3', 'Operación 3', 'Descripción de la operación 3'),
('P4', 'E4', 'Operación 4', 'Descripción de la operación 4'),
('P5', 'E5','Operación 5', 'Descripción de la operación 5')
GO
INSERT INTO PIEZA (ID_PIEZA, ID_OPE, DESCRIPCION, PESO_UNIT) VALUES
('Z1', 'P1', 'Pieza 1', 10.5),
('Z2', 'P2', 'Pieza 2', 15.2),
('Z3', 'P3', 'Pieza 3', 20.0),
('Z4', 'P4', 'Pieza 4', 25.8),
('Z5', 'P5', 'Pieza 5', 30.3)
GO

SELECT* FROM OPERACION
ALTER AUTHORIZATION ON DATABASE:: [MECANICO] TO SA